<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type of Pet Prediction</title>
</head>
<body>
    <h1>Type of Pet Prediction</h1>
    <p>Please answer each question using the following scale:</p>
    <ul>
        <li>Strongly Agree: 5</li>
        <li>Agree: 4</li>
        <li>Neutral: 3</li>
        <li>Disagree: 2</li>
        <li>Strongly Disagree: 1</li>
    </ul>
    <button id="startButton">Start Questions</button>
    <div id="questions"></div>
    <script>
        let questions = [
            ["Do you like spending time outdoors?", 0.5],
            ["Do you prefer to stay home?", 0.6],
            ["Are you afraid of dogs?", 0.8],
            ["Do you hate barking?", 0.7]
        ];
        let answers = [];
        let labels = [
            ["Dog"],
            ["Cat"],
            ["Dog"],
            ["Cat"],
            ["Cat"],
            ["Dog"],
            ["Cat"],
            ["Dog"],
            ["Dog"],
            ["Cat"]
        ];

        // Add event listener to button
        document.getElementById('startButton').addEventListener('click', askQuestions);

        function askQuestions() {
            const questionDiv = document.getElementById('questions');
            let index = 0;

            // start asking first 4 questions
            function askQuestion() {
                if (index < questions.length) {
                    const [question, weighting] = questions[index];
                    const answer = prompt(question);
                    answers.push(parseFloat(answer) * parseFloat(weighting));
                    index++;
                    askQuestion();
                } else {
                    // if we are done asking questions... ask preference so we can improve
                    const petPreference = prompt("What is your pet preference?");
                    improveModel(petPreference);
                }
            }

            askQuestion();
        }

        function improveModel(petPreference) {
            const k = 2; // # neighbors
            const prediction = predictPreference(answers, k);
            alert(`Predicted pet preference: ${prediction}`);
            labels.push([petPreference.trim()]);
        }

        function predictPreference(answers, k) {
            // normalize the answers
            const normalizedAnswers = answers.map((answer, index) => answer / questions[index][1]);
            const distances = [];
            for (let i = 0; i < labels.length; i++) {
                const label = labels[i];
                // vecorize labels
                const labelVector = labelsToVector(label);
                const distance = euclideanDistance(normalizedAnswers, labelVector);
                distances.push({ label: label[0], distance });
            }
            distances.sort((a, b) => a.distance - b.distance);
            const neighbors = distances.slice(0, k);
            const counts = {};
            neighbors.forEach(neighbor => {
                counts[neighbor.label] = (counts[neighbor.label] || 0) + 1;
            });
            const maxCountLabel = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
            return maxCountLabel;
        }

        function labelsToVector(label) {
            return label[0] === "Cat" ? [1, 1, 1, 1] : [0, 0, 0, 0];
        }

        function euclideanDistance(vector1, vector2) {
            // just incase our vectors don't have the same length
            if (vector1.length !== vector2.length) {
                throw new Error("Vector lengths do not match");
            }
            let sum = 0;
            for (let i = 0; i < vector1.length; i++) {
                sum += Math.pow(vector1[i] - vector2[i], 2);
            }
            return Math.sqrt(sum);
        }
    </script>
</body>
</html>
